<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste Protegido - Monitorado</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    
    .alerta-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #d32f2f;
      color: white;
      padding: 15px;
      text-align: center;
      z-index: 10000;
      display: none;
      animation: slideDown 0.3s ease-in;
    }
    
    .alerta-container.ativo {
      display: block;
    }
    
    @keyframes slideDown {
      from { transform: translateY(-100%); }
      to { transform: translateY(0); }
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      margin-top: 60px;
    }
    
    .info-teste {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #d32f2f;
    }
    
    .info-teste h2 {
      color: #d32f2f;
      margin-bottom: 10px;
    }
    
    .info-teste ul {
      margin-left: 20px;
      color: #666;
    }
    
    .info-teste li {
      margin: 8px 0;
      line-height: 1.6;
    }
    
    .aviso-critico {
      background: #ffebee;
      border: 2px solid #d32f2f;
      padding: 15px;
      border-radius: 4px;
      color: #b71c1c;
      margin-top: 10px;
      font-weight: bold;
    }
    
    .botao-abrir {
      display: inline-block;
      background: #d32f2f;
      color: white;
      padding: 12px 30px;
      border-radius: 4px;
      text-decoration: none;
      margin-top: 15px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      font-size: 16px;
      transition: background 0.3s;
    }
    
    .botao-abrir:hover {
      background: #b71c1c;
    }
    
    .contador-abas {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      font-weight: bold;
      color: #d32f2f;
      text-align: center;
      border: 2px solid #d32f2f;
    }
    
    .status {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="alerta-container" id="alerta">
    ‚ö†Ô∏è ALERTA: Voc√™ saiu desta aba! Sua tentativa foi registrada.
  </div>
  
  <div class="container">
    <div class="info-teste">
      <h2>üîí TESTE MONITORADO E PROTEGIDO</h2>
      <p><strong>REGRAS OBRIGAT√ìRIAS:</strong></p>
      <ul>
        <li>‚úó N√ÉO abra outras abas durante o teste</li>
        <li>‚úó N√ÉO abra novas janelas</li>
        <li>‚úó N√ÉO minimize ou saia desta aba</li>
        <li>‚úó N√ÉO use Alt+Tab para mudar de programa</li>
        <li>‚úó Mantenha APENAS esta aba aberta</li>
      </ul>
      <div class="aviso-critico">
        ‚ö†Ô∏è AVISO CR√çTICO:<br>
        Todas as tentativas de sair desta aba s√£o REGISTRADAS e enviadas automaticamente ao professor! Se voc√™ abrir outra aba, mesmo por um segundo, ficar√° registrado com data e hora. M√∫ltiplas tentativas resultar√£o em CANCELAMENTO autom√°tico da prova.
      </div>
      
      <button class="botao-abrir" onclick="iniciarTeste()">
        ‚ñ∂ INICIAR TESTE MONITORADO
      </button>
    </div>
  </div>
  
  <div class="contador-abas" id="contador">
    üìä Tentativas: 0
    <div class="status">Monitorando...</div>
  </div>
  
  <script>
    let tentativas = 0;
    let testeIniciado = false;
    let nomeAluno = '';
    let urlFormulario = "https://docs.google.com/forms/d/e/1FAIpQLScNQBacsNUzyRdnQzaeNEW3KVINXpnpW8wNTxNTOKQytr-09w/viewform";
    
    // URL para enviar dados ao Google Forms (criar um formul√°rio para logs)
    let urlRegistroMonitor = "https://docs.google.com/forms/d/e/1FAIpQLScNQBacsNUzyRdnQzaeNEW3KVINXpnpW8wNTxNTOKQytr-09w/formResponse";
    
    function iniciarTeste() {
      nomeAluno = prompt("Digite seu nome completo:");
      if (!nomeAluno || nomeAluno.trim() === '') {
        alert("Voc√™ deve digitar seu nome para come√ßar!");
        return;
      }
      
      testeIniciado = true;
      window.location.href = urlFormulario;
    }
    
    // Detectar quando sai da aba
    document.addEventListener('visibilitychange', function() {
      if (!testeIniciado) return;
      
      if (document.hidden) {
        tentativas++;
        document.getElementById('alerta').classList.add('ativo');
        document.getElementById('contador').textContent = 'üìä Tentativas: ' + tentativas + '\n‚ö†Ô∏è ALERTA ATIVO';
        
        // Registrar a tentativa
        registrarTentativa('Saiu da aba');
        
        if (tentativas >= 2) {
          alert('‚ùå PROVA CANCELADA!\n\nVoc√™ tentou sair da aba ' + tentativas + ' vez(es).\nSua tentativa foi registrada e o professor ser√° notificado.');
          document.location.href = 'about:blank';
        }
      } else {
        setTimeout(() => {
          document.getElementById('alerta').classList.remove('ativo');
        }, 3000);
      }
    });
    
    // Bloquear atalhos de teclado
    document.addEventListener('keydown', function(e) {
      if (!testeIniciado) return;
      
      // Ctrl/Cmd + T
      if ((e.ctrlKey || e.metaKey) && e.key === 't') {
        e.preventDefault();
        tentativas++;
        registrarTentativa('Tentou abrir nova aba (Ctrl+T)');
        alert('‚ùå BLOQUEADO! Tentativa de abrir outra aba foi registrada!\nTentativas: ' + tentativas);
      }
      // Ctrl/Cmd + W
      if ((e.ctrlKey || e.metaKey) && e.key === 'w') {
        e.preventDefault();
        tentativas++;
        registrarTentativa('Tentou fechar aba (Ctrl+W)');
        alert('‚ùå BLOQUEADO! Tentativa de fechar aba foi registrada!');
      }
      // Ctrl/Cmd + N
      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        tentativas++;
        registrarTentativa('Tentou abrir nova janela (Ctrl+N)');
        alert('‚ùå BLOQUEADO! Tentativa de abrir nova janela foi registrada!');
      }
      // F12 (DevTools)
      if (e.key === 'F12') {
        e.preventDefault();
        tentativas++;
        registrarTentativa('Tentou abrir DevTools (F12)');
        alert('‚ùå BLOQUEADO! Ferramentas de desenvolvedor desabilitadas!');
      }
    });
    
    // Bloquear clique direito
    document.addEventListener('contextmenu', function(e) {
      if (!testeIniciado) return;
      e.preventDefault();
      tentativas++;
      registrarTentativa('Tentou clicar direito');
      alert('‚ùå BLOQUEADO! Clique direito desabilitado!');
    });
    
    function registrarTentativa(tipo) {
      let data = new Date();
      let hora = data.toLocaleString('pt-BR');
      
      // Enviar para Google Forms (voc√™ precisa criar um formul√°rio para logs)
      console.log('REGISTRO: ' + hora + ' | ' + nomeAluno + ' | ' + tipo);
      
      // Opcional: enviar via fetch (pode n√£o funcionar por CORS)
      try {
        fetch(urlRegistroMonitor, {
          method: 'POST',
          body: new FormData()
        }).catch(err => console.log('Registro enviado'));
      } catch(e) {
        console.log('Tentativa registrada localmente');
      }
    }
    
    // Aviso ao tentar sair
    window.addEventListener('beforeunload', function(e) {
      if (!testeIniciado) return;
      e.preventDefault();
      e.returnValue = 'Voc√™ tem um teste em andamento! Todas as tentativas de abandono s√£o registradas.';
      tentativas++;
      registrarTentativa('Tentou sair/fechar navegador');
    });
    
    console.log('‚úì Sistema de Monitoramento Ativado');
  </script>
</body>
</html>
